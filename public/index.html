<!DOCTYPE html>
<html lang="en">
<head>
    <title>Honest25-AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white p-6">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-2xl font-bold mb-6 text-blue-500">Honest25-AI</h1>
        <div id="chat" class="space-y-4 mb-4 h-96 overflow-y-auto border border-zinc-800 p-4 rounded"></div>
        <div class="flex">
            <input id="input" class="flex-1 p-2 bg-zinc-900 border border-zinc-700 rounded-l" placeholder="Type here...">
            <button onclick="send()" class="bg-blue-600 p-2 rounded-r">Send</button>
        </div>
        <p id="status" class="mt-2 text-zinc-500 text-center"></p>
    </div>
    <script>
        let messages = [];
        async function send() {
            const input = document.getElementById('input');
            const query = input.value;
            if (!query) return;
            document.getElementById('chat').innerHTML += `<p class="text-right"><b>You:</b> ${query}</p>`;
            input.value = '';
            const status = document.getElementById('status');
            status.textContent = 'Thinking...';
            messages.push({ role: 'user', content: query });
            const res = await fetch('/api/chat', { method: 'POST', body: JSON.stringify({ messages }) });
            const reader = res.body.getReader();
            const decoder = new TextDecoder();
            let reply = '';
            const replyP = document.createElement('p');
            replyP.innerHTML = '<b>Honest25:</b> ';
            document.getElementById('chat').appendChild(replyP);
            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                const chunk = decoder.decode(value);
                const lines = chunk.split('\n\n');
                for (const line of lines) {
                    if (line.startsWith('data: ')) {
                        const data = JSON.parse(line.slice(6));
                        if (data.status) status.textContent = data.status;
                        if (data.content) {
                            reply += data.content;
                            replyP.innerHTML = `<b>Honest25:</b> ${reply}`;
                        }
                        if (data.done) status.textContent = `Used: ${data.modelUsed}`;
                    }
                }
            }
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        }
    </script>
</body>
</html>
